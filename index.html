<html>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <head>
    <title>d3 visualisation</title>
    </head>
        <body>
            <svg id="visual" width="100%" height="100%"></svg>
            <script type="text/javascript">
        
            d3.json("data.json", function(error, dataset) {
                if (error) 
                    throw error;
                
                var width = d3.select("#visual")
                                .node()
                                .getBoundingClientRect()
                                .width;
                
                var height = d3.select("#visual")
                                .node()
                                .getBoundingClientRect()
                                .height;
                var diameter;
                if(width>height)
                    diameter = height;
                else
                    diameter = width;

                var bubble = d3.pack(dataset)
                    .size([width, height])
                    .padding(1.5);

                var svg = d3.select("#visual")
                    .attr("class", "bubble");

                var nodes = d3.hierarchy(dataset)
                    .sum(function(d) { return d.Add; });

                var node = svg.selectAll(".node")
                    .data(bubble(nodes).descendants())
                    .enter()
                    .filter(function(d){
                        return  !d.children
                    })
                    .append("g")
                    .attr("class", "node")
                    .attr("transform", function(d) {
                        return "translate(" + d.x + "," + d.y + ")";
                    });
                    
                var color = d3.scaleLinear()
                    .domain([
                        d3.min(dataset.children, function(d) { return (d.Add/d.Del);}),
                        d3.max(dataset.children, function(d) { return (d.Add/d.Del);})])
                    .range(["silver","gold"]);
                

                node.append("title")
                    .text(function(d) {
                        return "Name:" + d.data.Name + "\nLines added:" + d.data.Add + 
                        "\nLines deleted:" + d.data.Del;
                    });

                node.append("circle")
                    .attr("r", function(d) {
                        return d.r;
                    })
                    .style("fill", function(d,i) {
                        return color(d.data.Add/d.data.Del);
                    });

                node.append("text")
                    .attr("dy", ".2em")
                    .style("text-anchor", "middle")
                    .text(function(d) {
                        return d.data.Name.substring(0, d.r / 3);
                    })
                    .attr("font-family", "sans-serif")
                    .attr("font-size", function(d){
                        return d.r/5;
                    })
                    .attr("fill", "black");

                node.append("text")
                    .attr("dy", function(d){
                        ".2" + d.r/5 + "em"
                    })
                    .style("text-anchor", "middle")
                    .text(function(d) {
                        return d.data.Add.toString().substring(0, d.r / 3);
                    })
                    .attr("font-family",  "Gill Sans", "Gill Sans MT")
                    .attr("font-size", function(d){
                        return d.r/5;
                    })
                    .attr("fill", "green");
                
                node.append("text")
                    .attr("dy", function(d){
                        ".2" + 2*(d.r/5) + "em"
                    })
                    .style("text-anchor", "middle")
                    .text(function(d) {
                        return d.data.Del.toString().substring(0, d.r / 3);
                    })
                    .attr("font-family",  "Gill Sans", "Gill Sans MT")
                    .attr("font-size", function(d){
                        return d.r/5;
                    })
                    .attr("fill", "red");
            
            });
              
            </script>
        </body>
    </head>
</html>